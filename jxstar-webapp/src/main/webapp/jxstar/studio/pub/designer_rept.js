/*
 * Copyright 2011 Guangzhou Donghong Software Technology Inc.
 * Licensed under the www.jxstar.org
 */
Jxstar.currentPage={reportId:"",layoutEl:null,render:function(c,d){var a=this;this.reportId=c;this.layoutEl=d;var f=d.getTopToolbar();var b=d.getComponent(0);if(b){b.removeAll(true);b.destroy();b=null;f.removeAll(true)}var e="<div id='rpt_wall_top' class='wall_top'></div><div id='rpt_wall_left' class='wall_left'></div><div id='rpt_wall_center' class='wall_center'></div>";b=new Ext.Panel({id:"rept_design_panel",border:false,autoScroll:true,html:e});d.add(b);b.on("beforedestroy",function(){Ext.fly("rpt_wall_center").select("td").remove();return true});f.add({text:jx.rpt.title,iconCls:"eb_save",handler:function(){a.showHead()}},{text:jx.rpt.area,iconCls:"eb_change",handler:function(){a.showArea()}},{xtype:"tbseparator"},{text:jx.base.refresh,iconCls:"eb_refresh",handler:function(){a.reloadDesign()}});d.doLayout();this.design=b;this.readDesign(c)},readDesign:function(b){var a=this;var d="&funid=rpt_list&pagetype=grid&eventcode=loadfile&reportId="+b;var c=function(e){a.fillReportWall();Ext.fly("rpt_wall_center").insertHtml("beforeEnd","<div id='sel_rpttddiv' class='sel_rpttd'></div>");Ext.fly("rpt_wall_center").select("td").on("click",function(){a.clickTd(this)})};Request.fileUpdate("rpt_wall_center",d,c)},fillReportWall:function(){var d=Ext.getDom("xls_parser_table");if(d==null){return}var a=[];for(var c=0,f=d.rows.length;c<f;c++){a[c]=d.rows[c].offsetHeight}this.fillLeftWall(a);var e=[];var b=d.rows[0].cells;for(var c=0,f=b.length;c<f;c++){e[c]=b[c].offsetWidth}this.fillTopWall(e)},fillTopWall:function(d){var b="",c=22;for(var a=0,e=d.length;a<e;a++){if(a>0){c+=d[a-1]}b+="<div id='top_wall_"+a+"' class='tw_sub' style='width:"+d[a]+"px;left:"+c+"px'>"+a+"</div>"}Ext.fly("rpt_wall_top").insertHtml("beforeEnd",b)},fillLeftWall:function(d){var b="",c=0;for(var a=0,e=d.length;a<e;a++){if(a>0){c+=d[a-1]}b+="<div id='left_wall_"+a+"' class='lw_sub' style='height:"+d[a]+"px;top:"+c+"px;'>"+a+"</div>"}Ext.fly("rpt_wall_left").insertHtml("beforeEnd",b)},reloadDesign:function(){this.render(this.reportId,this.layoutEl)},clickTd:function(c){var e=Ext.get(c);var a=e.getStyle("color");if(a!="rgb(255, 0, 0)"&&a!="red"){JxHint.alert(jx.rpt.selemp);return}var d=Ext.get("sel_rpttddiv");d.setX(e.getX());d.setY(e.getY());d.setWidth(e.getWidth());d.setHeight(e.getHeight());if(d.oldRecord!=null&&d.curRecord!=d.oldRecord){d.curTd=null}if(d.curRecord!=null&&d.curTable!=null){if(d.curTd!=null){d.curTd.dom.innerHTML=""}d.curTd=e;d.oldRecord=d.curRecord;var b=d.curRecord.get(d.curTable+"__display");e.dom.innerHTML=b;d.curRecord.set(d.curTable+"__col_pos",c.id)}},showHead:function(){var a=this;var e="rpt_head.report_id = ?";var b="string";var c=a.reportId;var d=function(f){f.getBottomToolbar().hide();JxUtil.delay(500,function(){a.layoutEl.rpt_head=f;f.fkValue=c;Jxstar.loadData(f,{where_sql:e,where_value:c,where_type:b})})};Jxstar.showData({filename:"/jxstar/studio/grid_rpt_head.js",title:jx.rpt.titdef,pagetype:"subeditgrid",nodedefine:Jxstar.findNode("rpt_head"),width:600,height:250,modal:false,callback:d})},showArea:function(){var a=this;var e="rpt_area.report_id = ?";var b="string";var c=a.reportId;var d=function(f){f.getBottomToolbar().hide();JxUtil.delay(500,function(){a.layoutEl.rpt_area=f;f.fkValue=c;Jxstar.loadData(f,{where_sql:e,where_value:c,where_type:b})})};Jxstar.showData({filename:"/jxstar/studio/grid_rpt_area.js",title:jx.rpt.aredef,pagetype:"subeditgrid",nodedefine:Jxstar.findNode("rpt_area"),width:600,height:250,modal:false,callback:d})},showParam:function(){JxHint.alert("暂时不需要！")}};