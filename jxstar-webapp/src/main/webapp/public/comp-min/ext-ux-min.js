/*
 * Ext JS Library 3.3.1
 * Copyright(c) 2006-2010 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
Ext.ns("Ext.ux.grid");Ext.ux.grid.RowExpander=Ext.extend(Ext.util.Observable,{expandOnEnter:true,expandOnDblClick:true,header:"",width:20,sortable:false,fixed:true,hideable:false,menuDisabled:true,dataIndex:"",id:"expander",lazyRender:true,enableCaching:true,constructor:function(a){Ext.apply(this,a);this.addEvents({beforeexpand:true,expand:true,beforecollapse:true,collapse:true});Ext.ux.grid.RowExpander.superclass.constructor.call(this);if(this.tpl){if(typeof this.tpl=="string"){this.tpl=new Ext.Template(this.tpl)}this.tpl.compile()}this.state={};this.bodyContent={}},getRowClass:function(a,e,d,c){d.cols=d.cols-1;var b=this.bodyContent[a.id];if(!b&&!this.lazyRender){b=this.getBodyContent(a,e)}if(b){d.body=b}return this.state[a.id]?"x-grid3-row-expanded":"x-grid3-row-collapsed"},init:function(b){this.grid=b;var a=b.getView();a.getRowClass=this.getRowClass.createDelegate(this);a.enableRowBody=true;b.on("render",this.onRender,this);b.on("destroy",this.onDestroy,this)},onRender:function(){var a=this.grid;var b=a.getView().mainBody;b.on("mousedown",this.onMouseDown,this,{delegate:".x-grid3-row-expander"});if(this.expandOnEnter){this.keyNav=new Ext.KeyNav(this.grid.getGridEl(),{enter:this.onEnter,scope:this})}if(this.expandOnDblClick){a.on("rowdblclick",this.onRowDblClick,this)}},onDestroy:function(){if(this.keyNav){this.keyNav.disable();delete this.keyNav}var a=this.grid.getView().mainBody;if(a){a.un("mousedown",this.onMouseDown,this)}},onRowDblClick:function(a,b,c){this.toggleRow(b)},onEnter:function(h){var f=this.grid;var j=f.getSelectionModel();var b=j.getSelections();for(var c=0,a=b.length;c<a;c++){var d=f.getStore().indexOf(b[c]);this.toggleRow(d)}},getBodyContent:function(a,b){if(!this.enableCaching){return this.tpl.apply(a.data)}var c=this.bodyContent[a.id];if(!c){c=this.tpl.apply(a.data);this.bodyContent[a.id]=c}return c},onMouseDown:function(b,a){b.stopEvent();var c=b.getTarget(".x-grid3-row");this.toggleRow(c)},renderer:function(b,c,a){c.cellAttr='rowspan="2"';return'<div class="x-grid3-row-expander">&#160;</div>'},beforeExpand:function(b,a,c){if(this.fireEvent("beforeexpand",this,b,a,c)!==false){if(this.tpl&&this.lazyRender){a.innerHTML=this.getBodyContent(b,c)}return true}else{return false}},toggleRow:function(a){if(typeof a=="number"){a=this.grid.view.getRow(a)}this[Ext.fly(a).hasClass("x-grid3-row-collapsed")?"expandRow":"collapseRow"](a)},expandRow:function(c){if(typeof c=="number"){c=this.grid.view.getRow(c)}var b=this.grid.store.getAt(c.rowIndex);var a=Ext.DomQuery.selectNode("tr:nth(2) div.x-grid3-row-body",c);if(this.beforeExpand(b,a,c.rowIndex)){this.state[b.id]=true;Ext.fly(c).replaceClass("x-grid3-row-collapsed","x-grid3-row-expanded");this.fireEvent("expand",this,b,a,c.rowIndex)}},collapseRow:function(c){if(typeof c=="number"){c=this.grid.view.getRow(c)}var b=this.grid.store.getAt(c.rowIndex);var a=Ext.DomQuery.selectNode("tr:nth(2) div.x-grid3-row-body",c);if(this.fireEvent("beforecollapse",this,b,a,c.rowIndex)!==false){this.state[b.id]=false;Ext.fly(c).replaceClass("x-grid3-row-expanded","x-grid3-row-collapsed");this.fireEvent("collapse",this,b,a,c.rowIndex)}}});Ext.preg("rowexpander",Ext.ux.grid.RowExpander);Ext.grid.RowExpander=Ext.ux.grid.RowExpander;
/*
 * Ext JS Library 3.3.1
 * Copyright(c) 2006-2010 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
Ext.ux.Portal=Ext.extend(Ext.Panel,{layout:"column",autoScroll:true,cls:"x-portal",defaultType:"portalcolumn",initComponent:function(){Ext.ux.Portal.superclass.initComponent.call(this);this.addEvents({validatedrop:true,beforedragover:true,dragover:true,beforedrop:true,drop:true})},initEvents:function(){Ext.ux.Portal.superclass.initEvents.call(this);this.dd=new Ext.ux.Portal.DropZone(this,this.dropConfig)},beforeDestroy:function(){if(this.dd){this.dd.unreg()}Ext.ux.Portal.superclass.beforeDestroy.call(this)}});Ext.reg("portal",Ext.ux.Portal);Ext.ux.Portal.DropZone=Ext.extend(Ext.dd.DropTarget,{constructor:function(a,b){this.portal=a;Ext.dd.ScrollManager.register(a.body);Ext.ux.Portal.DropZone.superclass.constructor.call(this,a.bwrap.dom,b);a.body.ddScrollConfig=this.ddScrollConfig},ddScrollConfig:{vthresh:50,hthresh:-1,animate:true,increment:200},createEvent:function(a,f,d,b,h,g){return{portal:this.portal,panel:d.panel,columnIndex:b,column:h,position:g,data:d,source:a,rawEvent:f,status:this.dropAllowed}},notifyOver:function(v,t,w){var f=t.getXY(),a=this.portal,n=v.proxy;if(!this.grid){this.grid=this.getGrid()}var b=a.body.dom.clientWidth;if(!this.lastCW){this.lastCW=b}else{if(this.lastCW!=b){this.lastCW=b;a.doLayout();this.grid=this.getGrid()}}var d=0,l=this.grid.columnX,m=false;for(var s=l.length;d<s;d++){if(f[0]<(l[d].x+l[d].w)){m=true;break}}if(!m){d--}var q,k=false,i=0,u=a.items.itemAt(d),o=u.items.items,j=false;for(var s=o.length;i<s;i++){q=o[i];var r=q.el.getHeight();if(r===0){j=true}else{if((q.el.getY()+(r/2))>f[1]){k=true;break}}}i=(k&&q?i:u.items.getCount())+(j?-1:0);var g=this.createEvent(v,t,w,d,u,i);if(a.fireEvent("validatedrop",g)!==false&&a.fireEvent("beforedragover",g)!==false){n.getProxy().setWidth("auto");if(q){n.moveProxy(q.el.dom.parentNode,k?q.el.dom:null)}else{n.moveProxy(u.el.dom,null)}this.lastPos={c:u,col:d,p:j||(k&&q)?i:false};this.scrollPos=a.body.getScroll();a.fireEvent("dragover",g);return g.status}else{return g.status}},notifyOut:function(){delete this.grid},notifyDrop:function(l,h,g){delete this.grid;if(!this.lastPos){return}var j=this.lastPos.c,f=this.lastPos.col,k=this.lastPos.p,a=l.panel,b=this.createEvent(l,h,g,f,j,k!==false?k:j.items.getCount());if(this.portal.fireEvent("validatedrop",b)!==false&&this.portal.fireEvent("beforedrop",b)!==false){l.proxy.getProxy().remove();a.el.dom.parentNode.removeChild(l.panel.el.dom);if(k!==false){j.insert(k,a)}else{j.add(a)}j.doLayout();this.portal.fireEvent("drop",b);var m=this.scrollPos.top;if(m){var i=this.portal.body.dom;setTimeout(function(){i.scrollTop=m},10)}}delete this.lastPos},getGrid:function(){var a=this.portal.bwrap.getBox();a.columnX=[];this.portal.items.each(function(b){a.columnX.push({x:b.el.getX(),w:b.el.getWidth()})});return a},unreg:function(){Ext.dd.ScrollManager.unregister(this.portal.body);Ext.ux.Portal.DropZone.superclass.unreg.call(this)}});
/*
 * Ext JS Library 3.3.1
 * Copyright(c) 2006-2010 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
Ext.ux.PortalColumn=Ext.extend(Ext.Container,{layout:"anchor",defaultType:"portlet",cls:"x-portal-column"});Ext.reg("portalcolumn",Ext.ux.PortalColumn);
/*
 * Ext JS Library 3.3.1
 * Copyright(c) 2006-2010 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
Ext.ux.Portlet=Ext.extend(Ext.Panel,{anchor:"100%",frame:true,collapsible:true,draggable:true,cls:"x-portlet"});Ext.reg("portlet",Ext.ux.Portlet);
/*
 * Ext JS Library 3.3.1
 * Copyright(c) 2006-2010 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
Ext.ns("Ext.ux.grid");Ext.ux.grid.RowEditor=Ext.extend(Ext.Panel,{floating:true,shadow:false,layout:"hbox",cls:"x-small-editor",buttonAlign:"center",baseCls:"x-row-editor",elements:"header,footer,body",frameWidth:5,buttonPad:3,clicksToEdit:"auto",monitorValid:true,focusDelay:250,errorSummary:true,saveText:"Save",cancelText:"Cancel",commitChangesText:"You need to commit or cancel your changes",errorText:"Errors",defaults:{normalWidth:true},initComponent:function(){Ext.ux.grid.RowEditor.superclass.initComponent.call(this);this.addEvents("beforeedit","canceledit","validateedit","afteredit")},init:function(a){this.grid=a;this.ownerCt=a;if(this.clicksToEdit===2){a.on("rowdblclick",this.onRowDblClick,this)}else{a.on("rowclick",this.onRowClick,this);if(Ext.isIE){a.on("rowdblclick",this.onRowDblClick,this)}}a.getStore().on("remove",function(){this.stopEditing(false)},this);a.on({scope:this,keydown:this.onGridKey,columnresize:this.verifyLayout,columnmove:this.refreshFields,reconfigure:this.refreshFields,beforedestroy:this.beforedestroy,destroy:this.destroy,bodyscroll:{buffer:250,fn:this.positionButtons}});a.getColumnModel().on("hiddenchange",this.verifyLayout,this,{delay:1});a.getView().on("refresh",this.stopEditing.createDelegate(this,[]))},beforedestroy:function(){this.stopMonitoring();this.grid.getStore().un("remove",this.onStoreRemove,this);this.stopEditing(false);Ext.destroy(this.btns,this.tooltip)},refreshFields:function(){this.initFields();this.verifyLayout()},isDirty:function(){var a;this.items.each(function(b){if(String(this.values[b.id])!==String(b.getValue())){a=true;return false}},this);return a},startEditing:function(k,p){if(this.editing&&this.isDirty()){this.showTooltip(this.commitChangesText);return}if(Ext.isObject(k)){k=this.grid.getStore().indexOf(k)}if(this.fireEvent("beforeedit",this,k)!==false){this.editing=true;var e=this.grid,l=e.getView(),o=l.getRow(k),c=e.store.getAt(k);this.record=c;this.rowIndex=k;this.values={};if(!this.rendered){this.render(l.getEditorParent())}var m=Ext.fly(o).getWidth();this.setSize(m);if(!this.initialized){this.initFields()}var n=e.getColumnModel(),d=this.items.items,j,a;for(var b=0,h=n.getColumnCount();b<h;b++){a=this.preEditValue(c,n.getDataIndex(b));j=d[b];j.setValue(a);this.values[j.id]=Ext.isEmpty(a)?"":a}this.verifyLayout(true);if(!this.isVisible()){this.setPagePosition(Ext.fly(o).getXY())}else{this.el.setXY(Ext.fly(o).getXY(),{duration:0.15})}if(!this.isVisible()){this.show().doLayout()}if(p!==false){this.doFocus.defer(this.focusDelay,this)}}},stopEditing:function(l){this.editing=false;if(!this.isVisible()){return}if(l===false||!this.isValid()){this.hide();this.fireEvent("canceledit",this,l===false);return}var g={},b=this.record,h=false,k=this.grid.colModel,e=this.items.items;for(var d=0,f=k.getColumnCount();d<f;d++){if(!k.isHidden(d)){var c=k.getDataIndex(d);if(!Ext.isEmpty(c)){var a=b.data[c],j=this.postEditValue(e[d].getValue(),a,b,c);if(String(a)!==String(j)){g[c]=j;h=true}}}}if(h&&this.fireEvent("validateedit",this,g,b,this.rowIndex)!==false){b.beginEdit();Ext.iterate(g,function(i,m){b.set(i,m)});b.endEdit();this.fireEvent("afteredit",this,g,b,this.rowIndex)}this.hide()},verifyLayout:function(e){if(this.el&&(this.isVisible()||e===true)){var g=this.grid.getView().getRow(this.rowIndex);this.setSize(Ext.fly(g).getWidth(),Ext.isIE?Ext.fly(g).getHeight()+9:undefined);var c=this.grid.colModel,b=this.items.items;for(var d=0,a=c.getColumnCount();d<a;d++){if(!c.isHidden(d)){var f=0;if(d===(a-1)){f+=3}else{f+=1}b[d].show();b[d].setWidth(c.getColumnWidth(d)-f)}else{b[d].hide()}}this.doLayout();this.positionButtons()}},slideHide:function(){this.hide()},initFields:function(){var b=this.grid.getColumnModel(),f=Ext.layout.ContainerLayout.prototype.parseMargins;this.removeAll(false);for(var e=0,a=b.getColumnCount();e<a;e++){var g=b.getColumnAt(e),d=g.getEditor();if(!d){d=g.displayEditor||new Ext.form.DisplayField()}if(e==0){d.margins=f("0 1 2 1")}else{if(e==a-1){d.margins=f("0 0 2 1")}else{if(Ext.isIE){d.margins=f("0 0 2 0")}else{d.margins=f("0 1 2 0")}}}d.setWidth(b.getColumnWidth(e));d.column=g;if(d.ownerCt!==this){d.on("focus",this.ensureVisible,this);d.on("specialkey",this.onKey,this)}this.insert(e,d)}this.initialized=true},onKey:function(a,b){if(b.getKey()===b.ENTER){this.stopEditing(true);b.stopPropagation()}},onGridKey:function(c){if(c.getKey()===c.ENTER&&!this.isVisible()){var b=this.grid.getSelectionModel().getSelected();if(b){var a=this.grid.store.indexOf(b);this.startEditing(a);c.stopPropagation()}}},ensureVisible:function(a){if(this.isVisible()){this.grid.getView().ensureVisible(this.rowIndex,this.grid.colModel.getIndexById(a.column.id),true)}},onRowClick:function(b,d,c){if(this.clicksToEdit=="auto"){var a=this.lastClickIndex;this.lastClickIndex=d;if(a!=d&&!this.isVisible()){return}}this.startEditing(d,false);this.doFocus.defer(this.focusDelay,this,[c.getPoint()])},onRowDblClick:function(a,c,b){this.startEditing(c,false);this.doFocus.defer(this.focusDelay,this,[b.getPoint()])},onRender:function(){Ext.ux.grid.RowEditor.superclass.onRender.apply(this,arguments);this.el.swallowEvent(["keydown","keyup","keypress"]);this.btns=new Ext.Panel({baseCls:"x-plain",cls:"x-btns",elements:"body",layout:"table",width:(this.minButtonWidth*2)+(this.frameWidth*2)+(this.buttonPad*4),items:[{ref:"saveBtn",itemId:"saveBtn",xtype:"button",text:this.saveText,width:this.minButtonWidth,handler:this.stopEditing.createDelegate(this,[true])},{xtype:"button",text:this.cancelText,width:this.minButtonWidth,handler:this.stopEditing.createDelegate(this,[false])}]});this.btns.render(this.bwrap)},afterRender:function(){Ext.ux.grid.RowEditor.superclass.afterRender.apply(this,arguments);this.positionButtons();if(this.monitorValid){this.startMonitoring()}},onShow:function(){if(this.monitorValid){this.startMonitoring()}Ext.ux.grid.RowEditor.superclass.onShow.apply(this,arguments)},onHide:function(){Ext.ux.grid.RowEditor.superclass.onHide.apply(this,arguments);this.stopMonitoring();this.grid.getView().focusRow(this.rowIndex)},positionButtons:function(){if(this.btns){var e=this.grid,d=this.el.dom.clientHeight,b=e.getView(),a=b.scroller.dom.scrollLeft,f=this.btns.getWidth(),c=Math.min(e.getWidth(),e.getColumnModel().getTotalWidth());this.btns.el.shift({left:(c/2)-(f/2)+a,top:d-2,stopFx:true,duration:0.2})}},preEditValue:function(a,c){var b=a.data[c];return this.autoEncode&&typeof b==="string"?Ext.util.Format.htmlDecode(b):b},postEditValue:function(c,a,b,d){return this.autoEncode&&typeof c=="string"?Ext.util.Format.htmlEncode(c):c},doFocus:function(f){if(this.isVisible()){var d=0,b=this.grid.getColumnModel(),g;if(f){d=this.getTargetColumnIndex(f)}for(var e=d||0,a=b.getColumnCount();e<a;e++){g=b.getColumnAt(e);if(!g.hidden&&g.getEditor()){g.getEditor().focus();break}}}},getTargetColumnIndex:function(k){var a=this.grid,j=a.view,h=k.left,f=a.colModel.config,b=0,d=false;for(var e=f.length,g;g=f[b];b++){if(!g.hidden){if(Ext.fly(j.getHeaderCell(b)).getRegion().right>=h){d=b;break}}}return d},startMonitoring:function(){if(!this.bound&&this.monitorValid){this.bound=true;Ext.TaskMgr.start({run:this.bindHandler,interval:this.monitorPoll||200,scope:this})}},stopMonitoring:function(){this.bound=false;if(this.tooltip){this.tooltip.hide()}},isValid:function(){var a=true;this.items.each(function(b){if(!b.isValid(true)){a=false;return false}});return a},bindHandler:function(){if(!this.bound){return false}var a=this.isValid();if(!a&&this.errorSummary){this.showTooltip(this.getErrorText().join(""))}this.btns.saveBtn.setDisabled(!a);this.fireEvent("validation",this,a)},lastVisibleColumn:function(){var a=this.items.getCount()-1,b;for(;a>=0;a--){b=this.items.items[a];if(!b.hidden){return b}}},showTooltip:function(f){var c=this.tooltip;if(!c){c=this.tooltip=new Ext.ToolTip({maxWidth:600,cls:"errorTip",width:300,title:this.errorText,autoHide:false,anchor:"left",anchorToTarget:true,mouseOffset:[40,0]})}var b=this.grid.getView(),e=parseInt(this.el.dom.style.top,10),a=b.scroller.dom.scrollTop,d=this.el.getHeight();if(e+d>=a){c.initTarget(this.lastVisibleColumn().getEl());if(!c.rendered){c.show();c.hide()}c.body.update(f);c.doAutoWidth(20);c.show()}else{if(c.rendered){c.hide()}}},getErrorText:function(){var a=["<ul>"];this.items.each(function(b){if(!b.isValid(true)){a.push("<li>",b.getActiveError(),"</li>")}});a.push("</ul>");return a}});Ext.preg("roweditor",Ext.ux.grid.RowEditor);Ext.form.Emptybox=Ext.extend(Ext.form.Field,{defaultAutoCreate:{tag:"label",html:" "},actionMode:"wrap",markInvalid:Ext.emptyFn,clearInvalid:Ext.emptyFn,onRender:function(b,a){Ext.form.Emptybox.superclass.onRender.call(this,b,a);if(this.inputValue!==undefined){this.el.dom.value=this.inputValue}this.wrap=this.el.wrap({cls:"x-form-empty-wrap"});if(this.boxLabel){this.wrap.createChild({tag:"label",htmlFor:this.el.id,cls:"x-form-cb-label",html:this.boxLabel})}if(Ext.isIE){this.wrap.repaint()}this.resizeEl=this.positionEl=this.wrap},onDestroy:function(){Ext.destroy(this.wrap);Ext.form.Emptybox.superclass.onDestroy.call(this)},initValue:Ext.emptyFn,getValue:function(){return""},onClick:Ext.emptyFn,setValue:function(a){return this},isDirty:function(){return false}});Ext.reg("emptybox",Ext.form.Emptybox);
/*
 * Ext JS Library 3.3.1
 * Copyright(c) 2006-2010 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
Ext.ns("Ext.ux.form");Ext.ux.form.FileUploadField=Ext.extend(Ext.form.DisplayField,{buttonText:"Browse...",buttonOnly:false,buttonOffset:3,readOnly:true,useType:"field",autoSize:Ext.emptyFn,initComponent:function(){Ext.ux.form.FileUploadField.superclass.initComponent.call(this);this.addEvents("fileselected")},onRender:function(c,a){Ext.ux.form.FileUploadField.superclass.onRender.call(this,c,a);this.wrap=this.el.wrap({cls:"x-form-field-wrap x-form-file-wrap"});this.el.addClass("x-form-file-text");this.el.dom.removeAttribute("name");this.createFileInput();var b=Ext.applyIf(this.buttonCfg||{},{text:this.buttonText});if(this.useType=="field"){b.text="";b.iconCls="upload_icon"}this.button=new Ext.Button(Ext.apply(b,{renderTo:this.wrap,cls:"x-form-file-btn"+(b.iconCls?" x-btn-icon":"")}));if(this.buttonOnly){this.el.hide();this.wrap.setWidth(this.button.getEl().getWidth())}this.bindListeners();this.resizeEl=this.positionEl=this.wrap},bindListeners:function(){this.fileInput.on({scope:this,mouseenter:function(){this.button.addClass(["x-btn-over","x-btn-focus"])},mouseleave:function(){this.button.removeClass(["x-btn-over","x-btn-focus","x-btn-click"])},mousedown:function(){if(this.useType=="field"){JxAttach.beforeChange(this)}this.button.addClass("x-btn-click")},mouseup:function(){this.button.removeClass(["x-btn-over","x-btn-focus","x-btn-click"])},change:function(){var c=this.fileInput.dom.value;var b=c.length;if(b>0){var d=c.lastIndexOf("\\");if(d>=0){c=c.substr(d+1,b)}}b=JxUtil.strlen(c);var a=this.maxLength||50;if(b<=a){this.setValue(c);this.fireEvent("fileselected",this,c);if(this.useType=="field"){JxAttach.saveAttach(this)}}else{JxHint.alert(jx.req.maxlen+a);this.fileInput.dom.value=""}}})},createFileInput:function(){this.fileInput=this.wrap.createChild({id:this.getFileInputId(),name:this.name||this.getId(),cls:"x-form-file",tag:"input",type:"file",size:1})},reset:function(){this.fileInput.remove();this.createFileInput();this.bindListeners();Ext.ux.form.FileUploadField.superclass.reset.call(this)},getFileInputId:function(){return this.id+"-file"},onResize:function(a,b){Ext.ux.form.FileUploadField.superclass.onResize.call(this,a,b);this.wrap.setWidth(a);if(!this.buttonOnly){var a=this.wrap.getWidth()-this.button.getEl().getWidth()-this.buttonOffset;this.el.setWidth(a)}},onDestroy:function(){Ext.ux.form.FileUploadField.superclass.onDestroy.call(this);Ext.destroy(this.fileInput,this.button,this.wrap)},onDisable:function(){Ext.ux.form.FileUploadField.superclass.onDisable.call(this);this.doDisable(true)},onEnable:function(){Ext.ux.form.FileUploadField.superclass.onEnable.call(this);this.doDisable(false)},doDisable:function(a){if(this.fileInput){this.fileInput.dom.disabled=a}if(this.button){this.button.setDisabled(a)}},setReadOnly:function(a){Ext.ux.form.FileUploadField.superclass.setReadOnly.call(this,a);this.doDisable(a)},preFocus:Ext.emptyFn,alignErrorIcon:function(){this.errorIcon.alignTo(this.wrap,"tl-tr",[2,0])},getRawValue:function(){return this.value},setRawValue:function(a){if(!Ext.isEmpty(a)){var c=a.lastIndexOf("\\");if(c>=0){a=a.substr(c+1,a.length)}}else{a=""}this.value=a;this.originalValue=a;if(this.useType=="field"){if(this.htmlEncode){a=Ext.util.Format.htmlEncode(a)}var b="<span onclick='JxAttach.deleteAttach(this)' class='clear_attach'>&nbsp;&nbsp;&nbsp;&nbsp;</span><a href='#' onclick='JxAttach.showAttach(this)'>"+a+"</a>";if(this.rendered){this.el.dom.innerHTML=(Ext.isEmpty(a)?"":b)}}else{if(this.rendered){this.el.dom.innerHTML=a}}return a}});Ext.reg("fileuploadfield",Ext.ux.form.FileUploadField);Ext.form.FileUploadField=Ext.ux.form.FileUploadField;
/*
 * Ext JS Library 3.3.1
 * Copyright(c) 2006-2010 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
Ext.ux.JxPagerTool=Ext.extend(Object,{init:function(b){var e=[[20,"20"],[50,"50"],[100,"100"],[200,"200"]];var d=new Ext.form.ComboBox({triggerAction:"all",mode:"local",width:50,editable:false,store:new Ext.data.SimpleStore({fields:["value","text"],data:e}),valueField:"value",displayField:"text",value:50,listeners:{select:function(h,f,g){b.pageSize=f.get("value");b.changePage(1);return true}}});var c=Ext.Toolbar;var a=b.items.indexOf(b.displayItem);b.insert(a+1,new c.TextItem(", 每页"));b.insert(a+2,d);b.insert(a+3,new c.TextItem("条"))}});
/*
 * Ext JS Library 3.3.1
 * Copyright(c) 2006-2010 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
Ext.ux.form.JxImageField=Ext.extend(Ext.form.DisplayField,{uploadType:"0",uploadUrl:"",addbtnCls:"x-tool-plus",delbtnCls:"x-tool-minus",blankText:"This field is required",allowBlank:true,value:"",initComponent:function(){Ext.ux.form.JxImageField.superclass.initComponent.call(this);this.addEvents("beforesave","aftersave","beforedelete","afterdelete")},onRender:function(b,a){this.uploadType=Jxstar.systemVar.uploadType;this.uploadUrl=Jxstar.systemVar.uploadUrl;Ext.ux.form.JxImageField.superclass.onRender.call(this,b,a);this.wrap=this.el.wrap({cls:"x-form-field-wrap x-form-image-wrap"});this.el.hide();this.el.dom.removeAttribute("name");this.createImage();this.addbtn=this.wrap.createChild(this.addbtnCfg||{tag:"img",src:Ext.BLANK_IMAGE_URL,alt:"",cls:"x-form-image-btn x-tool "+this.addbtnCls,title:"上传图片",style:"right:20px;"});this.delbtn=this.wrap.createChild(this.delbtnCfg||{tag:"img",src:Ext.BLANK_IMAGE_URL,alt:"",cls:"x-form-image-btn x-tool "+this.delbtnCls,title:"删除图片",style:"right:2px;"});this.initBtn();this.resizeEl=this.positionEl=this.wrap},afterRender:function(){Ext.ux.form.JxImageField.superclass.afterRender.call(this);if(this.rendered){JxUtil.delay(500,function(){this.imageEl.setWidth(this.imageEl.getWidth()-2)},this);this.loadImage(Ext.BLANK_IMAGE_URL)}},getErrors:function(a){var b=[];if(this.allowBlank==false&&(a.length<1||a===this.emptyText)){b.push(this.blankText)}return b},isValid:function(){var a=Ext.form.DisplayField.superclass.isValid.call(this);return a},validate:function(){var a=Ext.form.DisplayField.superclass.validate.call(this);return a},getRawValue:function(){return this.value},getValue:function(){return this.getRawValue()},setValue:function(a){this.value=a;return this},createImage:function(){this.imageEl=this.wrap.createChild({id:this.getImageId(),name:this.name||this.getId(),cls:"x-form-image",tag:"img",src:this.getImageUrl()})},getImageId:function(){return this.id+"-img"},getImageUrl:function(){return this.imageUrl},initBtn:function(){this.mon(this.addbtn,"click",this.onAddClick,this);this.addbtn.addClassOnOver(this.addbtnCls+"-over");this.mon(this.delbtn,"click",this.onDelClick,this);this.delbtn.addClassOnOver(this.delbtnCls+"-over")},onDestroy:function(){Ext.destroy(this.imageEl,this.addbtn,this.delbtn,this.wrap);Ext.ux.form.JxImageField.superclass.onDestroy.call(this)},onDisable:function(){Ext.ux.form.JxImageField.superclass.onDisable.call(this);this.doDisable(true)},onEnable:function(){Ext.ux.form.JxImageField.superclass.onEnable.call(this);this.doDisable(false)},setReadOnly:function(a){Ext.ux.form.JxImageField.superclass.setReadOnly.call(this,a);this.doDisable(a)},doDisable:function(a){if(this.addbtn&&this.delbtn){if(a){this.addbtn.addClass(this.disabledClass);this.delbtn.addClass(this.disabledClass)}else{this.addbtn.removeClass(this.disabledClass);this.delbtn.removeClass(this.disabledClass)}}this.disabled=a},loadImage:function(b){if(b){this.imageUrl=b}else{var c=JxAttach.attachParam(this,"fdown");if(c==null){return}var a=Jxstar.path;if(this.uploadType=="1"){a=this.uploadUrl}c=c.params;if(this.loadImageParam){c=this.loadImageParam(this)}this.imageUrl=a+"/fileAction.do?"+c+"&dataType=byte&&nousercheck=1&dc="+(new Date()).getTime()}this.imageEl.dom.src=this.imageUrl},clearImage:function(){this.setValue("");if(this.imageEl){this.imageUrl=Ext.BLANK_IMAGE_URL;this.imageEl.dom.src=this.imageUrl}},onDelClick:function(){if(this.disabled){return}var a=this;var b=function(){var h=JxAttach.attachParam(a,"fdelete");if(h==null){return}if(a.fireEvent("beforedelete",a,h)==false){return}var e="0",g="6";if(h.define.status){e=h.define.status.audit0}var c=e;if(h.define.auditcol.length>0){c=h.form.get(h.define.auditcol)}if(c!=e&&c!=g){JxHint.alert("业务记录已提交，不能删除附件！");return}var f=function(){a.fireEvent("afterdelete",a,h);a.loadImage()};if(a.uploadType=="1"){var d=a.uploadUrl+"/fileAction.do?"+h.params+"&nousercheck=1";Ext.fly("frmhidden").dom.src=d;JxUtil.delay(800,function(){f()})}else{Request.postRequest(h.params,f)}};Ext.Msg.confirm(jx.base.hint,"确定删除当前图片附件吗？",function(c){if(c=="yes"){b()}})},onRemoteAdd:function(){var b=this;var c=b.uploadUrl;var a='<iframe frameborder="no" style="display:none;border-width:0;width:100%;height:100%;"></iframe>';var d=new Ext.Window({title:"上传附件",layout:"fit",width:400,height:160,modal:true,closeAction:"close",html:a,listeners:{show:function(f){var h=JxAttach.attachParam(b,"fcreate");var e=c+"/public/core/uploadfield.jsp?"+h.params+"&user_id="+Jxstar.session.user_id;var g=f.getEl().child("iframe");g.dom.src=e+"&_dc="+(new Date()).getTime();g.show()}}});d.on("close",function(){b.setValue("remote.gif");b.loadImage()});d.show()},onAddClick:function(){if(this.disabled){return}if(this.uploadType=="1"){this.onRemoteAdd();return}var c=this;var d=this.name;var a=new Ext.form.FormPanel({layout:"form",labelAlign:"right",labelWidth:80,border:false,baseCls:"x-plain",autoHeight:true,bodyStyle:"padding: 20px 10px 0 10px;",items:[{anchor:"95%",allowBlank:false,xtype:"fileuploadfield",useType:"file",fieldLabel:jx.event.selfile,name:d,labelSeparator:"*",buttonText:"",buttonCfg:{iconCls:"upload_icon"}}]});var b=this;var e=new Ext.Window({title:jx.event.uptitle,layout:"fit",width:400,height:130,resizable:false,modal:true,closeAction:"close",items:[a],buttons:[{text:jx.base.ok,handler:function(){var h=a.getForm();if(!h.isValid()){return}var f=h.get(d);var j=JxAttach.attachParam(c,"fcreate");if(j==null){return}if(b.fireEvent("beforesave",b,j)==false){return}var i=j.params+"&attach_name="+encodeURIComponent(f);var g=function(){e.close();b.fireEvent("aftersave",b,j);c.setValue(f);c.originalValue=f;if(j.form&&j.form.myRecord){var k=j.form.myRecord;k.set(d,f);k.commit()}c.loadImage()};Request.fileRequest(h,i,g)}},{text:jx.base.cancel,handler:function(){e.close()}}]});e.show()}});Ext.reg("imagefield",Ext.ux.form.JxImageField);